---
title: "Классические_статистические_тесты.ДЗ"
author: "Ekaterina Vostokova"
date: "2024-11-25"
output: html_document
---


```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)

```

# Инструкции

Ниже приведены семь клинических (исследовательских) гипотез. В качестве задания протестируйте их, используя соответствующие статистические критерии. Решение должно содержать все элементы алгоритма проверки статистических гипотез:

• Сформулируете нулевую и альтернативную гипотезы.
• Укажите уровень значимости α.
• Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста. 
• Укажите критическое значение статистики (используйте распределения из материалов лекции).
• Определите наблюдаемое значение статистики.
• Оцените статистическую значимость (p-value и/или доверительный интервал).
• Оцените практическую значимость.


* Решение необходимо загружать в формате Rmd (воспроизводимый код).
** Данные для анализа необходимо генерировать самостоятельно в соответствии с каждой представленной гипотезой. По возможности используйте пакет dplyr
*** Предусмотрен мягкий дедлайн (17 ноября). В этом случае вы получите комментарии с возможностью повысить оценку. Сдача работы после жёсткого дедлайна (24 ноября) предусматривает снижение оценки (10 баллов).


# Гипотеза 1. Существует ассоциация между уровнем физической активности (бинарная переменная, физическая активность может быть 'высокой' и 'низкой') и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет. Попробуйте вариант с большими выборками (sample_size <- 100). Как изменится стратегия при малых выборках (sample_size <- 30) ? 

## Генерация данных

Нулевая гипотеза: Между уровнем физической активности (бинарная переменная, физическая активность может быть 'высокой' и 'низкой') и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет нет связи.

Альтернативная гипотеза: Между уровнем физической активности (бинарная переменная, физическая активность может быть 'высокой' и 'низкой') и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет есть связь.

Уровень статистической значимости α = 0.05.

Для проверки гипотезы будет использоваться хи-квадрат в случае выборки в 100 пациентов, точный тест Фишера в случае выборки в 30 пациентов.

```{r task1}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки 
sample_size_100 <- 100

# Генерация данных по физической активности (бинарная переменная) в фиксированном соотношении 1:1
activity_100 <- sample(c("high", "low"), size = sample_size_100, replace = TRUE, prob = c(0.5, 0.5))

# Генерация данных по наличию сердечно-сосудистых заболеваний (бинарная переменная)
# У активных людей меньше вероятность заболеть (0.5 vs 0.6)

cardio_100 <- ifelse(activity_100 == "high", 
                 rbinom(sample_size_100, 1, 0.5), 
                 rbinom(sample_size_100, 1, 0.6))
```


```{r task1_datagen}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки
sample_size_30 <- 30

# Генерация данных по физической активности (бинарная переменная) в фиксированном соотношении 1:1
activity_30 <- sample(c("high", "low"), size = sample_size_30, replace = TRUE, prob = c(0.5, 0.5))

# Генерация данных по наличию сердечно-сосудистых заболеваний (бинарная переменная)
# У активных людей меньше вероятность заболеть (0.5 vs 0.6)

cardio_30 <-  ifelse(activity_30 == "high", 
                 rbinom(sample_size_30, 1, 0.5), 
                 rbinom(sample_size_30, 1, 0.6))
```


## Решение
Для выборки в 100 пациентов.
```{r task1_chisq}
chisq_test_100 <- chisq.test(table(activity_100, cardio_100))
chisq_test_100
```
Получаем p-value 0.08, соответственно не можем отвергнуть нулевую гипотезу.

Для выборки в 30 пациентов (альтернативно можем использовать точный тест Фишера).
```{r task1_fisher}
fisher_30 <- fisher.test(table(activity_30, cardio_30))
fisher_30
```
В данном случае также не можем отвергнуть нулевую гипотезу.

# Гипотеза 2. Применение нового метода лечения для пациентов с артериальной гипертензией приведет к уменьшению среднего артериального давления по сравнению с пациентами, получающими стандартное лечение.

Нулевая гипотеза: нет разницы в уровне среднего артериального давления у пациентов с артериальной гипертензией, получающих стандартное лечение и новую терапию.

Альтернативная гипотеза: Уровни среднего артериального давления у пациентов с артериальной гипертензией, получающих стандартное лечение и новую терапию, различаются.

Уровень статистической значимости α = 0.05.

Используем t-test.

## Генерация данных 

```{r task2_datagen}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки (в каждой группе)
sample_size <- 80


# В популяции c экспериментальным методом лечения средний уровень систолического артериального давления меньше (130 vs 135 mm) 
# Генерация данных для группы с новым методом лечения 
group1 <- rnorm(sample_size, mean = 130, sd = 10)  # экспериментальная группа

# Генерация данных для группы со стандартным лечением
group2 <- rnorm(sample_size, mean = 135, sd = 10)  # контрольная группа

```

## Решение

```{r task2_ttest}
t_test_out <- t.test(group1, group2)
t_test_out

```
P-value < 0.05, соответственно есть основания отвергнуть нулевую гипотезу и считать, что разница между стандартным и новым методами лечения действительно значима.


# Гипотеза 3. Внедрение программы реабилитации для пациентов с хронической болью в спине приведет к улучшению их физической активности (предположим что физическую активность можно оценить по шкале 0-100)

Нулевая гипотеза: физическая активность пациентов с хронической болью в спине не отличается при внедрении программы реабилитации и при ее отсутствии.

Альтернативная гипотеза: физическая активность пациентов с хронической болью в спине улучшается при внедрении программы реабилитации.

Уровень статистической значимости α = 0.05.

Используем парный t-test, так как сравниваем одних и тех же пациентов до и после реабилитации.
## Генерация данных 

```{r task3_datagen}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки 
sample_size <- 30

# В популяции до реабилитации средний уровень физической активности меньше (50 vs 60) 
# Генерация данных до реабилитации
before <- rnorm(sample_size, mean = 50, sd = 10)

# Генерация данных после реабилитации
after <- rnorm(sample_size, mean = 60, sd = 10)  

```

## Решение

```{r task3_ttest}
paired_test <- t.test(before, after, paired = TRUE)
paired_test
```
P-value < 0.05, есть основания отклонить нулевую гипотезу, наблюдаем значимое улучшение физической активности пациентов после внедрения программы реабилитации.


# Гипотеза 4. Применение нового метода лечения для пациентов с инфарктом миокарда увеличит долю вернувшихся к нормальной физической активности 

Нулевая гипотеза: нет различия в долях пациентов, вернувшихся к нормальной физической активности после инфаркта миокарда, при применении нового метода лечения и со стандартной терапией.

Альтернативная гипотеза: применение нового метода лечения изменяет долю вернувшихся к нормальной физической активности пациентов после инфаркта миокарда.

Уровень статистической значимости α = 0.05.

Используем хи-квадрат. 

## Генерация данных 

```{r task4_datagen}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки
sample_size <- 200


# В популяции экспериментального лечения вероятность нормальной физической активности больше (0.7 vs 0.65)
# Генерация данных по статусу лечение (бинарная переменная, новый метод или стандарт) в фиксированном соотношении 1:1
treatment <- sample(c("new", "old"), size = sample_size, replace = TRUE, prob = c(0.5, 0.5))


# Генерация данных по физической активности после лечения (бинарная переменная)
activity <- ifelse(treatment == "new", 
                   rbinom(sample_size, 1, 0.7), 
                   rbinom(sample_size, 1, 0.65))
    
```

## Решение

```{r task4_chisq}
chisq_test <- chisq.test(table(treatment, activity))
chisq_test

```
По результатам теста не можем отвергнуть нулевую гипотезу.

# Гипотеза 5. Применение медитации в течение 8 недель повлияет на наличие стресса (есть/нет) у лиц с высоким уровнем тревожности.

Нулевая гипотеза: наличие стресса не изменяется при применении медитации в течение 8 недель у лиц с высоким уровнем тревожности.

Альтернативная гипотеза: наличие стресса изменяется при применении медитации в течение 8 недель у лиц с высоким уровнем тревожности.

Уровень значимости α = 0.05

Так как у нас зависимые бинарные данные, можем использовать тест Мак-Нимара.

## Генерация данных 

```{r task5_datagen}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 50

# Генерация данных до медитации (бинарная переменная) в фиксированном соотношении 1:1
before <- sample(c(0, 1), size = sample_size, replace = TRUE, prob = c(0.5, 0.5))

# Генерация данных после медитации (бинарная переменная). После медитации вероятность наличия стресса меньше (0.2 vs 0.4)
after <- ifelse(before == 0, 
                rbinom(sample_size, 1, 0.2), 
                rbinom(sample_size, 1, 0.4))

```

## Решение

```{r task5_mcnemar}
mcnemar_test <- mcnemar.test(table(before, after))
mcnemar_test
```
P-value согласно тесту 0.04, при выбранном нами уровне значимости мы имеем основания отвергнуть нулевую гипотезу и считать, что примение медитации в течение 8 недель у лиц с высоким уровнем тревожности влияет на наличие стресса.


# Гипотеза 6. Применение альтернативного метода лечения для пациентов с биполярным расстройством приведет к значимому изменению уровня симптомов депрессии по отношению к группе, прошедшей стандартное лечение (депрессию можно определить по шкале от 0 до 100, при этом исследователь должен избегать любых предположений (кроме i.i.d.)).

## Генерация данных 

Нулевая гипотеза: уровень симптомов депрессии не отличается в группах со стандартным и альтернативных лечением для пациентов с биполярным расстройством.

Альтернативная гипотеза: В группах со стандартным и альтернативных лечением для пациентов с биполярным расстройством уровень симптомов депрессии будет различаться.

Уровень значимости α = 0.05



```{r task6_datagen}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки для каждой группы
sample_size <- 20


# В популяции c экспериментальным методом лечения среднее депрессии меньше (55 vs 68) 
# Генерация данных для экспериментальной группы 
group1 <- rnorm(sample_size, mean = 55, sd = 5)  # экспериментальная группа

# Генерация данных для группы со стандартным лечением
group2 <- rnorm(sample_size, mean = 68, sd = 5)  # контрольная группа

hist(group1)
hist(group2)

```
По гистограммам видим, что распределение не нормальное, поэтому используем тест Манн-Уитни.
## Решение

```{r task6}
wilcox_test <- wilcox.test(group1, group2)
wilcox_test
```
C данными условиями получаем p-value < 0.05, можем отвергнуть нулевую гипотезу и считаем, что в группах со стандартным и альтернативных лечением для пациентов с биполярным расстройством уровень симптомов депрессии будет различаться. 


# Гипотеза 7. Длительность сна (в часах) ассоциирована с уровенем стресса у студентов (шкала с нормальным распределением)

## Генерация данных  

```{r}

library(mvtnorm) # библиотека mvtnorm для работы с многомерным нормальным распределением

# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 100

# Средние значения для длительности сна (HoursOfSleep) и уровня стресса (StressLevel) в популяции
means <- c(7, 5)  

# Матрица ковариации. В ислледуемой популяции HoursOfSleep и StressLevel ассоциированы отрицательно (r = -0.5)
cov_matrix <- matrix(c(1, -0.5, -0.5, 1), nrow = 2)

df <- rmvnorm(n = sample_size, 
              mean = means, 
              sigma = cov_matrix) %>% 
      as_tibble() %>%
      setNames(c("HoursOfSleep", "StressLevel"))  

```
## Решение (дополните решение визуализацией)

```{r corr}
correlation_test <- cor.test(df$HoursOfSleep, df$StressLevel)
correlation_test

```


```{r visual}
ggplot(df, aes(x = HoursOfSleep, y = StressLevel)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  theme_bw() +
  labs(title = "Correlation between Hours of Sleep and Stress Level",
       x = "Hours of Sleep",
       y = "Stress Level")
```


Уровень стресса имеет отрицательную взаимосвязь с количеством часов сна. Это подтверждается как тестом, так и визуализацией.





